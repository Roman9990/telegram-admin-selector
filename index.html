<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç WebApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            padding: 20px; 
            font-family: Arial, sans-serif; 
            background: #f0f0f0;
        }
        .info { 
            background: white; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border: 1px solid #ddd;
        }
        button { 
            background: #0088cc; 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            border-radius: 8px; 
            font-size: 16px; 
            cursor: pointer;
            width: 100%;
        }
        .debug {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–ï–°–¢ TELEGRAM WEBAPP</h1>

    <div class="info">
        <h3>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—É—Å–∫–µ:</h3>
        <div id="startup-info">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
    </div>

    <div class="info">
        <h3>üîç –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:</h3>
        <div id="debug-log"></div>
    </div>

    <div class="info">
        <h3>‚öôÔ∏è –î–∞–Ω–Ω—ã–µ WebApp:</h3>
        <div id="webapp-data">–ó–∞–≥—Ä—É–∂–∞–µ–º...</div>
    </div>

    <button onclick="testSendData()">üöÄ –¢–ï–°–¢: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç</button>

    <script>
        function log(message) {
            const debugLog = document.getElementById('debug-log');
            const time = new Date().toLocaleTimeString();
            debugLog.innerHTML += `<div class="debug">[${time}] ${message}</div>`;
            console.log(`[DEBUG] ${message}`);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
        log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram...');

        if (typeof window.Telegram === 'undefined') {
            log('‚ùå window.Telegram –ù–ï –ù–ê–ô–î–ï–ù!');
            document.getElementById('startup-info').innerHTML = `
                <strong style="color: red;">‚ùå –û–®–ò–ë–ö–ê: –°–∞–π—Ç –æ—Ç–∫—Ä—ã—Ç –Ω–µ –≤ Telegram!</strong><br>
                <small>–û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤ –±–æ—Ç–µ</small>
            `;
        } else {
            log('‚úÖ window.Telegram –Ω–∞–π–¥–µ–Ω');
        }

        const tg = window.Telegram?.WebApp;

        if (!tg) {
            log('‚ùå WebApp API –ù–ï –î–û–°–¢–£–ü–ï–ù!');
            document.getElementById('startup-info').innerHTML = `
                <strong style="color: red;">‚ùå WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</strong><br>
                <small>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram</small>
            `;
        } else {
            log('‚úÖ WebApp API –¥–æ—Å—Ç—É–ø–µ–Ω');

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            tg.ready();
            tg.expand();

            document.getElementById('startup-info').innerHTML = `
                <strong style="color: green;">‚úÖ Telegram WebApp —Ä–∞–±–æ—Ç–∞–µ—Ç!</strong><br>
                <small>–í–µ—Ä—Å–∏—è: ${tg.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}</small>
            `;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ WebApp
            const webappData = document.getElementById('webapp-data');
            webappData.innerHTML = `
                <strong>–í–µ—Ä—Å–∏—è:</strong> ${tg.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}<br>
                <strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> ${tg.platform || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}<br>
                <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> ${tg.initDataUnsafe?.user?.first_name || '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}<br>
                <strong>User ID:</strong> ${tg.initDataUnsafe?.user?.id || '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}<br>
                <strong>sendData –¥–æ—Å—Ç—É–ø–µ–Ω:</strong> ${typeof tg.sendData === 'function' ? '‚úÖ –î–ê' : '‚ùå –ù–ï–¢'}
            `;
        }

        function testSendData() {
            if (!tg) {
                log('‚ùå –û–®–ò–ë–ö–ê: WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏!');
                alert('WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω! –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤ –±–æ—Ç–µ.');
                return;
            }

            if (typeof tg.sendData !== 'function') {
                log('‚ùå –û–®–ò–ë–ö–ê: tg.sendData() –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è!');
                alert('tg.sendData() –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —ç—Ç–æ–π –≤–µ—Ä—Å–∏–µ–π Telegram!');
                return;
            }

            const testData = {
                action: 'test_connection',
                message: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç WebApp',
                timestamp: new Date().toISOString(),
                user_id: tg.initDataUnsafe?.user?.id || 'unknown'
            };

            log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(testData)}`);

            try {
                tg.sendData(JSON.stringify(testData));
                log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!');

                document.querySelector('button').textContent = '‚úÖ –î–ê–ù–ù–´–ï –û–¢–ü–†–ê–í–õ–ï–ù–´!';
                document.querySelector('button').style.background = '#28a745';

                setTimeout(() => {
                    if (tg.close) {
                        log('üö™ –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp...');
                        tg.close();
                    }
                }, 2000);

            } catch (error) {
                log(`‚ùå –û–®–ò–ë–ö–ê –æ—Ç–ø—Ä–∞–≤–∫–∏: ${error.message}`);
                alert(`–û—à–∏–±–∫–∞: ${error.message}`);
            }
        }

        log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
    </script>
</body>
</html>
